{% extends 'theme/extends/main.html' %}

{% block container %}
    {% if git_url_exists %}
        <div x-cloak x-init="git_url_exists = true"></div>
    {% endif %}
    {% if repo_dot_git_config_exists %}
        <div x-cloak x-init="repo_dot_git_config_exists = true"></div>
    {% endif %}
    {% if venv_exists %}
        <div x-cloak x-init="venv_exists = true"></div>
    {% endif %}
    {% if settings.COMMAND %}
        <div x-cloak x-init="command_exists = true"></div>
    {% endif %}
    {% if settings.GIT_PRIVATE %}
        <div x-cloak x-init="git_is_private = true"></div>
    {% endif %}


    <div class="box mb-4">

        <div x-show="!edit_command">
            {% include 'www/includes/display_command.html' %}
        </div>
        <div x-show="edit_command">
            {% include 'www/includes/edit_command.html' %}
        </div>

    </div>

    <div class="box mb-4">

        <div x-show="!edit_git">
            {% include 'www/includes/display_git.html' %}
        </div>

        <div x-show="edit_git">
            {% include 'www/includes/edit_git.html' %}
        </div>

    </div>

    <div class="box  mb-4">
        <p><strong>Environment</strong></p>
        <div class="mb-3">
            <button class="button button-green u-no-shadow"
                    :disabled="!repo_dot_git_config_exists"
                    x-show="!venv_exists"
                    @click="create_venv($el)"
            >
                Create Virtual
                Environment
            </button>
            <button class="button button-orange u-no-shadow"
                    x-show="venv_exists"
                    @click="recreate_venv($el)"
            >Recreate Virtual Environment
            </button>
            <button class="button button-green u-no-shadow"
                    x-show="venv_exists"
                    @click="install_requirements($el)"
            >Install requirements.txt
            </button>
        </div>

        <p>Installed Packages</p>

        <div class="small-alert" x-show="!venv_exists">No environment found.</div>

        <div x-show="venv_exists" x-cloak>
            <template x-for="package_ in packages" x-show="has_packages" x-cloak>
                <div class="tag-no-shadow" x-text="package_"></div>
            </template>
            <div class="small-alert" x-show="!has_packages">No packages installed</div>

            <form class="mt-3">
                <label for="install" class="u-no-bold">Install a package</label>
                <input name="install" type="text" placeholder="pip package name"
                       class="mb-0" x-model="package_name">
                <button type="button" class="u-no-shadow" @click="pip_install($el)">Install</button>
            </form>
        </div>

    </div>


    {#    <div class="box">#}
    {#        <div>#}
    {#            <p>#}
    {#                <strong>Webhook (#}
    {#                    {% if settings.WH_ENABLED %}#}
    {#                        <a href="{{ url_for('api.disable_webhook') }}">Disable</a>#}
    {#                    {% else %}#}
    {#                        <a href="{{ url_for('api.enable_webhook') }}">Enable</a>#}
    {#                    {% endif %}#}
    {#                    )#}
    {#                    {% if settings.WH_ENABLED %}#}
    {#                        ENABLED#}
    {#                    {% else %}#}
    {#                        DISABLED#}
    {#                    {% endif %}#}
    {#                </strong>#}
    {#            </p>#}
    {##}
    {#            <p style="margin-bottom: 8px; font-style: italic;">Secret <a#}
    {#                    href="{{ url_for('api.generate_new_secret') }}">Generate New Secret</a></p>#}
    {#            <div class="false_pre">{{ settings.WH_SECRET }}</div>#}
    {#            <p style="margin-bottom: 8px; margin-top: 5px">/api/webhook/[Webhook Secret] - Listening to default#}
    {#                branch</p>#}
    {#        </div>#}
    {#    </div>#}
{% endblock container %}
